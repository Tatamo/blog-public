<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="index,follow">
    <meta name="description" content="Tatamo&#39;s weblog">
    <meta name="author" content="Tatamo">
    <meta name="viewport" content="width=device-width">
    
    <base href="http://tatamo.81.la/blog/">
    <title>
      Javaのリフレクションを悪用してクラス設計してみる | わたしろぐ
    </title>
    <link rel="stylesheet" type="text/css" href="css/style.css" media="all">
    <link rel="canonical" href="http://tatamo.81.la/blog/2016/12/15/java-generics-and-reflection/">
    <link rel="stylesheet" href="highlight/styles/default.css">
    <script src="highlight/highlight.pack.js"></script>
    <script>
    
    window.addEventListener("DOMContentLoaded", () => {
        const elements = document.getElementsByTagName("code");
        for (const el of elements) {
            if (el.parentNode.tagName != "PRE") {
                
                el.style.display = "inline";
                el.style.margin = "0 2px";
                el.style.padding = "1px 3px";
                if (el.classList.length == 0) {
                    
                    el.classList.add("nohighlight");
                }
            }
            hljs.highlightBlock(el);
			
            if (el.classList.contains("nohighlight") ||
                el.classList.contains("lang-nohighlight") ||
                el.classList.contains("language-nohighlight")) {
                el.classList.add("hljs");
            }
        }
    }, false);
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-71305633-1', 'auto');
    ga('send', 'pageview');
    </script>
</head>
<body>
    <header>
        <h1 class="site-title"><a href="http://tatamo.81.la/blog/">わたしろぐ</a></h1>
        <h2 class="site-subtitle">私録</h2>
    </header>
    <nav class="head-nav">
        <ul>
        <li><a href="about/">about</a></li>
        <li><a href="https://twitter.com/__tatamo__" target="_blank">twitter</a></li>
        <li><a href="https://github.com/tatamo" target="_blank">github</a></li>
        </ul>
    </nav>
    <div class="container">
    <div class="main-content">

    <article class="article">
        <h1 class="article-title"><a href="http://tatamo.81.la/blog/2016/12/15/java-generics-and-reflection/">Javaのリフレクションを悪用してクラス設計してみる</a></h1>
        <span class="article-datetime"><time>2016-12-15 01:11:23</time></span>
        <p class="article-categories">Category:
        <a href="http://tatamo.81.la/blog/categories/dev/">dev</a></p>
        <p class="article-tags">Tag:
        <a href="http://tatamo.81.la/blog/tags/java/">java</a>
        <a href="http://tatamo.81.la/blog/tags/generics/">generics</a>
        <a href="http://tatamo.81.la/blog/tags/reflection/">reflection</a></p>
        <p>この記事は<a href="http://www.adventar.org/calendars/1881">Kobe University Advent Calendar 2016</a>の14日の記事です。遅刻です。
なお私は当該大学の学部2年(2016年12月現在)です。</p>
<hr>
<p>最近、大学の授業などで少しだけJavaに触れる機会があったので、ちょっとした黒魔術っぽいことでもやってみようと思います。</p>
<p>と思ったのですが、記事を書こうとして調べていたら普通に書きたかったことをわかりやすく書いている記事がありました。</p>
<ul>
<li><a href="http://d.hatena.ne.jp/Nagise/20131121/1385046248">new T()したいケースへの対処法 - プログラマーの脳みそ</a></li>
</ul>
<p>もう帰っていいですかね。</p>
<h2 id="総称型tに対してtclassやnew-tしたい">総称型Tに対してT.classやnew T()したい</h2>
<h3 id="ジェネリクスとは">ジェネリクスとは</h3>
<p>わざわざ書くまでもないとは思いますが、ジェネリクスについておさらいをしておきます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ArrayList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> strlist <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;();</span>
ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> intlist <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;();</span>
</code></pre></div><p>ArrayList<T>に対し、ジェネリクスとしてStringやIntegerなど、リストの要素として入れたい型をTの部分に具体的に書くことで、一つのクラスであるArrayListに利用者側が好きな要素を入れることができるようになります。</p>
<p>ジェネリクスを用いて自分でメソッドを定義する場合は、以下のようになります。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doSomething</span><span style="color:#f92672">(</span>T arg<span style="color:#f92672">){</span>
	<span style="color:#75715e">// doSomething
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

<span style="color:#75715e">// TをSomeClassのサブクラスに限定する
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> SomeClass<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">notDoAnything</span><span style="color:#f92672">(</span>T arg<span style="color:#f92672">){</span>
	<span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>これらのメソッドを呼び出すときは、<code>hoge.&lt;SomeClass&gt;doSomething();</code>のようになります。<br>
どうして<code>hoge.doSomething&lt;SomeClass&gt;();</code>じゃないんだろう。</p>
<h3 id="ジェネリクスはtclassやnew-tをさせてくれない">ジェネリクスはT.classやnew T()をさせてくれない</h3>
<p>Javaのジェネリクスでは、以下のコードはコンパイルエラーとなります。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> SomeClass<span style="color:#f92672">&gt;</span> List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getSubClassList</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>SomeClass<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">){</span>
	<span style="color:#66d9ef">return</span> list
		<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
		<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>value <span style="color:#f92672">-&gt;</span> value <span style="color:#66d9ef">instanceof</span> T<span style="color:#f92672">)</span> <span style="color:#75715e">// ここでlistの要素valueがTのインスタンスかどうか判別したい -&gt; error
</span><span style="color:#75715e"></span>		<span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> SomeClass<span style="color:#f92672">&gt;</span> List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getSubClassList2</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>SomeClass<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">){</span>
	<span style="color:#66d9ef">return</span> list
		<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
		<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>value <span style="color:#f92672">-&gt;</span> value<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> T<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#75715e">// instanceofがだめならclassを取得して判別したい -&gt; error
</span><span style="color:#75715e"></span>		<span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doSomething</span><span style="color:#f92672">(</span>String arg<span style="color:#f92672">){</span>
	T foo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> T<span style="color:#f92672">(</span>arg<span style="color:#f92672">);</span> <span style="color:#75715e">// T型の新しいインスタンスfooを作りたい -&gt; error
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>ジェネリクス型に対して、hoge instanceof T、T.class、new T()といった操作を行うことはできません。
残念でしたね。</p>
<h2 id="なぜしたいのか">なぜしたいのか</h2>
<h3 id="もしかして-設計が間違っている">もしかして： 設計が間違っている</h3>
<p>先ほどのgetSubClassListメソッドを見てみましょう。
正しく動くかどうかはさておき、やりたいことは以下の通りです：</p>
<ul>
<li>SomeClassとそのサブクラスを含んだリストlistの要素のうち、SomeClassのサブクラスTのインスタンスだけを要素とする新しいリストを取得したい。</li>
</ul>
<p>そもそも、抽象化された集合から具体的なクラスのインスタンスを取り出そうとすること自体がオブジェクト指向やポリモーフィズムの考え方に対する反逆である可能性があります。</p>
<p>SomeClassのリストであるlistをイテレートして、それぞれの要素のdoSomething()メソッドを呼べば、あとはそれがSomeClassのインスタンスであろうと、もしくはSomeClassを継承した別のクラスのインスタンスであろうと、外部からはただdoSomething()メソッドを呼ぶだけで操作が完結していなければなりません。
それがサブクラス固有のふるまいをするとしても、その実装はそのクラス自身に隠蔽されるべきなのです。</p>
<p>よって、サブクラスだけを取り出そうとする試み自体がナンセンスなものである可能性が非常に高く、まずそのような試みが必要になる設計そのものを見直す必要があります。</p>
<p>終わり。</p>
<h3 id="そうも言っていられない">そうも言っていられない</h3>
<p>実際その通りなのですが、それではこの記事が続きません。</p>
<p>ここからは、少し具体的なプログラムの設計を例にとって考えてみたいと思います。<br>
あなたはちょっとしたゲームを作るためのフレームワークを作っています。
その一部分が以下のようになります。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 抽象的なゲーム内エンティティクラス
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Entity</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> x<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> y<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Entity</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> y<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setX</span><span style="color:#f92672">(</span>x<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setY</span><span style="color:#f92672">(</span>y<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getX</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> x<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setX</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> x<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getY</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> y<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setY</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> y<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> y<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>EntityManager manager<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// なんでもかんでも××Managerという名前を付けるのはやめましょう
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EntityManager</span> <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>Entity<span style="color:#f92672">&gt;</span> all_entities<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">EntityManager</span><span style="color:#f92672">(){</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">all_entities</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Entity<span style="color:#f92672">&gt;();</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Entity e<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">all_entities</span><span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> ArrayList<span style="color:#f92672">&lt;</span>Entity<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getAll</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Entity<span style="color:#f92672">&gt;(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">all_entities</span><span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateAll</span><span style="color:#f92672">(){</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">all_entities</span><span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">(</span>e<span style="color:#f92672">-&gt;</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">));</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>なんのことはありませんね。
ゲーム内に登場するエンティティを表す抽象クラスEntityを作り、それをEntityManagerで管理します(なんでもかんでも××Managerという名前を付けるのはManagerクラスの肥大化を招きかねないため避けるべきであるなどという話もありますが、今回は置いておきます)。
たとえば毎フレームごとにメインループ内で<code>EntityManager#updateAll()</code>を呼び出すことで、全てのエンティティの更新を行ったりすることが想定されます。
オーソドックスなループ駆動型のゲームプログラム設計です。<br>
Entityインスタンスを作成するためのFactory Methodパターンを使うべきとか、そういう話もあっちでやってください。</p>
<p>あとは、このフレームワークの利用者にはEntityクラスを継承したクラスを作らせ、それをもとにゲームを作ってもらえればいいだけです。
以下のクラスを追加してみましょう。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// あなたです
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Player</span> <span style="color:#66d9ef">extends</span> Entity<span style="color:#f92672">{</span>
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> hp<span style="color:#f92672">;</span> <span style="color:#75715e">// プレイヤーはヒットポイントを持ちます
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Player</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> y<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> hp<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setHp</span><span style="color:#f92672">(</span>hp<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getHp</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> hp<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setHp</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> hp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">hp</span> <span style="color:#f92672">=</span> hp<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>EntityManager manager<span style="color:#f92672">){</span>
		<span style="color:#75715e">// プレイヤーが動きます
</span><span style="color:#75715e"></span>	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// 敵です
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Enemy</span> <span style="color:#66d9ef">extends</span> Entity <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> damage<span style="color:#f92672">;</span> <span style="color:#75715e">// 敵がプレイヤーに与えることのできるダメージ値です
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Enemy</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> y<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> damage<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setDamage</span><span style="color:#f92672">(</span>damage<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getDamage</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> damage<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setDamage</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> damage<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">damage</span> <span style="color:#f92672">=</span> damage<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		<span style="color:#75715e">// 敵が動きます
</span><span style="color:#75715e"></span>	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>プレイヤーと敵を登場させました。
常命の者であるプレイヤーにはヒットポイントが定められており、敵はこれを脅かすダメージ値を持っています。</p>
<p>注意しておく必要があるのは、これらのクラスはあくまでフレームワークの利用者が作るものだということです。
よって、EntityクラスやEntityManagerクラスからはこのようなEntityサブクラスの存在を知ることはできません。<br>
知る必要もないというのがオブジェクト指向の考え方だったはずです。
そうですよね？</p>
<p>ここで、「敵のダメージ値を参照して、プレイヤーのヒットポイントを減らす」処理をしたいという需要が当然生まれます。
実装の方法はいろいろあると思いますが、ひとまずこの処理を、Enemyのメソッドとして書いてみます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 敵です
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Enemy</span> <span style="color:#66d9ef">extends</span> Entity <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> damage<span style="color:#f92672">;</span> <span style="color:#75715e">// 敵がプレイヤーに与えることのできるダメージ値です
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Enemy</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> y<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> damage<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> y<span style="color:#f92672">);</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setDamage</span><span style="color:#f92672">(</span>damage<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getDamage</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> damage<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setDamage</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> damage<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">damage</span> <span style="color:#f92672">=</span> damage<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
	<span style="color:#a6e22e">@Override</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>EntityManager manager<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#75715e">// 敵が動きます
</span><span style="color:#75715e"></span>		<span style="color:#75715e">// プレイヤーがいたらダメージを与えます
</span><span style="color:#75715e"></span>		manager<span style="color:#f92672">.</span><span style="color:#a6e22e">getAll</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">((</span>entity<span style="color:#f92672">)-&gt;{</span> <span style="color:#75715e">// 全てのエンティティを調べる
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>entity <span style="color:#66d9ef">instanceof</span> Player<span style="color:#f92672">){</span> <span style="color:#75715e">//  エンティティがプレイヤーなら
</span><span style="color:#75715e"></span>				<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getX</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> entity<span style="color:#f92672">.</span><span style="color:#a6e22e">getX</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getY</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> entity<span style="color:#f92672">.</span><span style="color:#a6e22e">getY</span><span style="color:#f92672">()){</span> <span style="color:#75715e">// プレイヤーと敵の座標が同じなら
</span><span style="color:#75715e"></span>					<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doDamage</span><span style="color:#f92672">((</span>Player<span style="color:#f92672">)</span> entity<span style="color:#f92672">);</span> <span style="color:#75715e">// ダメージを与える
</span><span style="color:#75715e"></span>				<span style="color:#f92672">}</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">});</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doDamage</span><span style="color:#f92672">(</span>Player p<span style="color:#f92672">){</span>
		p<span style="color:#f92672">.</span><span style="color:#a6e22e">setHp</span><span style="color:#f92672">(</span>p<span style="color:#f92672">.</span><span style="color:#a6e22e">getHp</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getDamage</span><span style="color:#f92672">());</span> <span style="color:#75715e">// プレイヤーのヒットポイントをダメージ値分だけ減らします
</span><span style="color:#75715e"></span>	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ここであなたは気を利かせます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">manager<span style="color:#f92672">.</span><span style="color:#a6e22e">getAll</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">((</span>entity<span style="color:#f92672">)-&gt;{</span>
	<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>entity <span style="color:#66d9ef">instanceof</span> Player<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">if</span><span style="color:#f92672">(...){</span>
			<span style="color:#f92672">...</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>この部分です、どう見ても冗長ですし、いちいち全エンティティのリストをforEachで回しているので高速化も望めませんし、同様のコードクローンが至る所に発生するのは目に見えています。</p>
<p>できるならたとえばこう書きたい。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">manager<span style="color:#f92672">.&lt;</span>Player<span style="color:#f92672">&gt;</span>getAllOfSubClass<span style="color:#f92672">().</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">((</span>player<span style="color:#f92672">)-&gt;{</span>
	<span style="color:#66d9ef">if</span><span style="color:#f92672">(...){</span>
		<span style="color:#f92672">...</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>これでPlayerクラスだけが得られるなら、呼び出し側のコード量は減りますし、もしあなたがO(n^2)の処理をO(nlogn)に落とすような作業に慣れているなら、Managerクラスの内側でより高速になるような最適化を行い、その実装も内部に隠蔽することができます。</p>
<p>また、ゲームのセーブとロードをするときのことも考えてみます。
たとえばデータのセーブを行うときはとりあえずオブジェクトを文字列化するとして、<br>
<code>public String Entity#serialize()</code>などといったメソッドを作ってセーブし、ロード時には文字列配列を引数として受け取るようオーバーロードされたコンストラクタを使用してオブジェクトを再生成するといったことが考えられます。
そういうことはFactory Methodあたりに委譲するべきな気もしますし、うまくやらないとフレームワークの利用者側の負担が増える気もしますが、今は置いておきます。</p>
<p>結局、セーブデータのロード時にこのようなコードを書くことになるでしょう。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">	<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>E <span style="color:#66d9ef">extends</span> Entity<span style="color:#f92672">&gt;</span> E <span style="color:#a6e22e">createEntity</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> args<span style="color:#f92672">){</span> <span style="color:#75715e">// 可変長引数としてもよい
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> E<span style="color:#f92672">(</span>args<span style="color:#f92672">);</span> <span style="color:#75715e">// ジェネリクス型はnewできない -&gt; error
</span><span style="color:#75715e"></span>	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">loadSaveData</span><span style="color:#f92672">(</span>SaveData savedata<span style="color:#f92672">){</span>
		<span style="color:#75715e">// セーブデータから1行ずつ読み込んでオブジェクトを再生成する
</span><span style="color:#75715e"></span>		<span style="color:#f92672">...</span> <span style="color:#f92672">{</span>
			entityManager<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createEntity</span><span style="color:#f92672">(</span>agrs<span style="color:#f92672">));</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p>しかしジェネリクス型はnewできないため、コンパイルエラーとなります。</p>
<h2 id="解決策">解決策</h2>
<p>さて、だいぶん勿体つけたが、解決編に入ろう。</p>
<p>……というか、例として取り上げた題材が無理やりすぎた気がしてやる気が尽きかけてきました。</p>
<h3 id="リフレクションを使用する">リフレクションを使用する</h3>
<p>Javaにはリフレクションという機能があり、プログラムの実行中にクラス名やメソッド名を動的に取り扱うことができます。
これのClass<T>型を、ジェネリクスと併用しましょう。
<code>EntityManager#getAllOfSubClass</code>メソッドを考えてみます。
実装は以下のようになります。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">	<span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>E <span style="color:#66d9ef">extends</span> Entity<span style="color:#f92672">&gt;</span> List<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getAllOfSubClass</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> cls<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;)</span> all_entities<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
			<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>entity <span style="color:#f92672">-&gt;</span> entity<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> cls<span style="color:#f92672">)</span>
			<span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p>これを呼び出す際は、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">entityManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getAllOfSubClass</span><span style="color:#f92672">(</span>Player<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</code></pre></div><p>のようにして、Class型の<code>クラス名.class</code>を引数として与えます。
ここで型推論が働くので、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">entityManager<span style="color:#f92672">.&lt;</span>Player<span style="color:#f92672">&gt;</span>getAllOfSubClass<span style="color:#f92672">(</span>Player<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</code></pre></div><p>のようにPlayerクラス名を2度も書く必要はありません。</p>
<p>また、Playerクラスだけでなく、Playerクラスを継承したクラスも含めて判別したいときは、以下のようにします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">	<span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span>
	<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>E <span style="color:#66d9ef">extends</span> Entity<span style="color:#f92672">&gt;</span> List<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getAllOfSubClass</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> cls<span style="color:#f92672">){</span>
		<span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;)</span> all_entities<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
			<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>entity <span style="color:#f92672">-&gt;</span> cls<span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>entity<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()))</span>
			<span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p><code>createEntity</code>メソッドも、以下のようにすれば書くことができます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">	<span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>E <span style="color:#66d9ef">extends</span> Entity<span style="color:#f92672">&gt;</span> E <span style="color:#a6e22e">createEntity</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>E<span style="color:#f92672">&gt;</span> cls<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> args<span style="color:#f92672">){</span>
		<span style="color:#75715e">// cls型のString[]を引数にとるコンストラクタを呼び出す
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> cls<span style="color:#f92672">.</span><span style="color:#a6e22e">getConstructor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Class<span style="color:#f92672">&lt;?&gt;[]</span> <span style="color:#f92672">{</span> String<span style="color:#f92672">[].</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">}).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">(</span>args<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
</code></pre></div><p>やや黒魔術じみてきました。
実際にはE型がString[]を引数にとるコンストラクタを持つということが担保されていないためこれだけでは動かず、例外回避のためにいろいろやる必要があります。</p>
<p>最初の例に戻ってみましょう。<code>getSubClassList</code>は、以下のように書けます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T <span style="color:#66d9ef">extends</span> SomeClass<span style="color:#f92672">&gt;</span> List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getSubClassList</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>SomeClass<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">,</span> Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> cls<span style="color:#f92672">){</span>
	<span style="color:#66d9ef">return</span> list
		<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
		<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>value <span style="color:#f92672">-&gt;</span> value<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> cls<span style="color:#f92672">)</span>
		<span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// 呼び出し側
</span><span style="color:#75715e"></span>getSubClassList<span style="color:#f92672">(</span>list<span style="color:#f92672">,</span> SubClassOfSomeClass<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</code></pre></div><p>めでたしめでたし。</p>
<h3 id="おまけ">おまけ</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getStaticValue</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> cls<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">{</span> <span style="color:#75715e">// なにがthrows Exceptionだやる気あんのか
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> cls<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getStaticValue&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// 呼び出し
</span><span style="color:#75715e"></span>getStaticValue<span style="color:#f92672">(</span>SomeClass<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span> <span style="color:#75715e">// SomeClass.getStaticValue() を呼んでいるのと同じになる
</span></code></pre></div><p>staticメソッドも呼び出し可能なうえ、「そのクラスに与えられた名前のstaticメソッドが存在しない場合、その親クラスの同名のstaticメソッドを呼び出す」というようなふるまいを疑似的に再現することも可能です。</p>
<h2 id="おわり">おわり</h2>
<p><code>Class&lt;T&gt; cls</code>を引数にとり、<code>value.getClass() == cls</code>で比較を行うのは、実質的にはinstanceofの迂回といえます。<br>
この程度なら型安全性は一応担保されますが、コンストラクタやメソッドの取得と呼び出しまで始めた場合、throw宣言やcatch節が山のように膨らんだり、メソッドの存在確認や型の確認などに多大なコストを支払う必要がありそうです。
実際に使用するには相当の覚悟を必要とするでしょう。<strong>やめましょう。</strong></p>
<p>自分でプログラムを組んでいる際にこのような需要が発生することが時々あったので、Javaではリフレクションを使うことで強引に解決できると知って記事を書いてみましたが、自分の中ではむしろ「設計が悪い」の一言に実感が沸くという結果となった気がします。<br>
今回例に挙げたゲームプログラムの設計はまさしく昔私が作ったものそのものなのですが、記事を書く上で「リフレクションを使いたい理由付け」を明確にしようとすればするほど、その理由が無理やりなものにしかならないのではないかという気持ちに陥りました。
途中まで書いた記事がグダグダになりそうな予感がしてくると結構精神的につらい。<br>
……うーん。Abstract Factoryパターンとか、もととなるクラスが増えるとそれに合わせてFactoryクラスも増やさないといけないのがあまり好きじゃないので、そのあたりも動的になんとかできないかなどと思っていたのですが、なかなか難しいようです。</p>
<p>私感としては、instanceof Tの代用としてClass型を使用する程度は許容できますが、普通のプログラムを書くならそれ以上は安易に手を出すべきではないという印象です。</p>
<p>プログラミングをするときはまともな設計をするようにしましょう。</p>
        <p><a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="__tatamo__">Tweet</a></p>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </article>
    <nav class="article-nav-adjacent">
        <span class="article-link-next"><a href="http://tatamo.81.la/blog/2016/12/22/lr-parser-generator-implementation/">&lt;- Newer: LR(1)パーサジェネレータを自作して構文解析をする 第1回:かんたん構文解析入門</a></span>
        <span class="article-link-border"></span>
        <span class="article-link-prev"><a href="http://tatamo.81.la/blog/2016/12/07/intro-my-homebuilt-pc/">Older: 自作PCの紹介 -&gt;</a></span>
    </nav>

    </div>
    <aside class="sidebar">
        <div class="sidebar-content">
            <section>
                <h2 class="panel-title">Recent Posts</h2>
                <ul>
                <li><a href="http://tatamo.81.la/blog/2020/08/31/shinsotu-2021/" class="list-group-item">就活の記録</a></li>
                <li><a href="http://tatamo.81.la/blog/2019/12/10/automation-games/" class="list-group-item">自動化というゲームジャンルの成立と変遷</a></li>
                <li><a href="http://tatamo.81.la/blog/2019/09/04/symphonic-rain/" class="list-group-item">シンフォニック=レインの紹介、またはファルシータ・フォーセットについての考察のようなもの</a></li>
                <li><a href="http://tatamo.81.la/blog/2018/12/07/atcoder-cli-tutorial/" class="list-group-item">atcoder-cli チュートリアル</a></li>
                <li><a href="http://tatamo.81.la/blog/2018/12/07/atcoder-cli-installation-guide/" class="list-group-item">atcoder-cli インストールガイド</a></li>
                <li><a href="http://tatamo.81.la/blog/2018/12/07/atcoder-cli/" class="list-group-item">コマンドラインツールatcoder-cliを公開しました</a></li>
                </ul>
            </section>
            
            <section>
                <h2 class="panel-title"><a href="http://tatamo.81.la/blog/categories/">Categories</a></h2>
                <ul>
                <li><a href="http://tatamo.81.la/blog/categories/dev">dev (19)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/diary">diary (7)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/game">game (7)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/info">info (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/pc">pc (2)</a></li>
                </ul>
            </section>
            <section>
                <h2 class="panel-title"><a href="http://tatamo.81.la/blog/tags/">Tags</a></h2>
                <ul>
                <li><a href="http://tatamo.81.la/blog/tags/arago">arago (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/atcoder">atcoder (3)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/atcoder-cli">atcoder-cli (3)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/austin">austin (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/automation">automation (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/blog">blog (5)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/competitive-programming">competitive-programming (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/contest">contest (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/css">css (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/deploybot">deploybot (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/dtp">dtp (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/freeciv">freeciv (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/freecivcalc">freecivcalc (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/generics">generics (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/github">github (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/highlightjs">highlightjs (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/homebuilt_pc">homebuilt_pc (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/html">html (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/hugo">hugo (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/icpc">icpc (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/info">info (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/isucon">isucon (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/japari-watch">japari-watch (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/java">java (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/javascript">javascript (5)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/lexer">lexer (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/parser">parser (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/parser-generator">parser-generator (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/parsing">parsing (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/pc">pc (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/pixijs">pixijs (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/reflection">reflection (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/seccamp">seccamp (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/shukatu">shukatu (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/symphonic-rain">symphonic-rain (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/vivliostyle">vivliostyle (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/wercker">wercker (1)</a></li>
                </ul>
            </section>
        </div>
    </aside>

    </div>
   <footer>
        <p>Copyright (c) 2015 <a href="about/">Tatamo</a>.</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a></p>
    </footer>
</body>
</html>

