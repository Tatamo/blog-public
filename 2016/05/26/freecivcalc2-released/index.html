<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="index,follow">
    <meta name="description" content="Tatamo&#39;s weblog">
    <meta name="author" content="Tatamo">
    <meta name="viewport" content="width=device-width">
    
    <base href="http://tatamo.81.la/blog/">
    <title>
      FreecivCalc2を公開しました | わたしろぐ
    </title>
    <link rel="stylesheet" type="text/css" href="css/style.css" media="all">
    <link rel="canonical" href="http://tatamo.81.la/blog/2016/05/26/freecivcalc2-released/">
    <link rel="stylesheet" href="highlight/styles/default.css">
    <script src="highlight/highlight.pack.js"></script>
    <script>
    
    window.addEventListener("DOMContentLoaded", function(){
        var elements = document.getElementsByTagName("code");
        var l=elements.length;
        for(var i=0; i<l;i++){
            var el = elements[i];
            hljs.highlightBlock(el);
            if(el.parentNode.tagName.toLowerCase() != "pre") {
                el.style.display = "inline";
                el.style.margin = "0 2px";
                el.style.padding = "1px 3px";
            }
        }
    }, false);
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-71305633-1', 'auto');
    ga('send', 'pageview');
    </script>
</head>
<body>
    <header>
        <h1 class="site-title"><a href="http://tatamo.81.la/blog/">わたしろぐ</a></h1>
        <h2 class="site-subtitle">私録</h2>
    </header>
    <nav class="head-nav">
        <ul>
        <li><a href="about/">about</a></li>
        <li><a href="https://twitter.com/__tatamo__" target="_blank">twitter</a></li>
        <li><a href="https://github.com/tatamo" target="_blank">github</a></li>
        </ul>
    </nav>
    <div class="container">
    <div class="main-content">

    <article class="article">
        <h1 class="article-title"><a href="http://tatamo.81.la/blog/2016/05/26/freecivcalc2-released/">FreecivCalc2を公開しました</a></h1>
        <span class="article-datetime"><time>2016-05-26 15:47:37</time></span>
        <p class="article-categories">Category:
        <a href="http://tatamo.81.la/blog/categories/dev/">dev</a></p>
        <p class="article-tags">Tag:
        <a href="http://tatamo.81.la/blog/tags/freeciv/">freeciv</a>
        <a href="http://tatamo.81.la/blog/tags/freecivcalc/">freecivcalc</a></p>
        

<p>Freecivのユニット同士の戦闘勝率を手軽に行えるソフトであるFreecivCalcの新バージョン、FreecivCalc2を公開しました。</p>

<p>FreecivCalc2: <a href="http://tatamo.81.la/freecivcalc2/">http://tatamo.81.la/freecivcalc2/</a></p>

<p>以前から公開していた<a href="http://m06t625.81.la/files/FreecivCalc.html">FreecivCalc</a>はSilverlight上で動作するソフトのため、現状では動作するブラウザがほとんどなくなってきています。</p>

<p>そこでHTML5+JavaScript/TypeScriptに移植し、機能やインターフェースを大幅に見直したFreecivCalc2を開発しました。</p>

<p>Chrome, Opera, Firefox, Edgeでの動作を確認しています。</p>

<h2 id="freecivcalc2の新機能:0fe09111c483b88d0d4fda3fcdc49d63">FreecivCalc2の新機能</h2>

<p>FreecivCalc2の画面からユニットを選択し、各種補正情報を入力することで戦闘勝率を表示できます。また詳細結果タブを開くことで、戦闘後のユニットHPの期待値を表示できるほか、タブを保持しておくことで復数の戦闘の予測結果を見比べることなどができます。</p>

<p>従来バージョンでは、地形による防御ボーナスの適用の可否や特定のユニット同士の戦闘にかかる特殊補正などの補正の情報を手動で入力する必要がありました。
FreecivCalc2ではこれらの特殊補正は自動で適用されるため、Freecivの複雑な戦闘補正を十分に把握していない場合でも正確に戦闘勝率の予測が可能です。
ユニットにかけられている補正の一覧は、詳細結果タブ内で確認することができます。</p>

<h2 id="複数の言語-多様なルールセットに対応可能な拡張性:0fe09111c483b88d0d4fda3fcdc49d63">複数の言語、多様なルールセットに対応可能な拡張性</h2>

<p>戦闘補正の自動適用を実現するために、ユニットの情報や補正の条件など、ルールセットに関連するすべての情報を外部データ化しました。
これによってclassicルールセットだけでなく、多様なルールセットに対応することが可能です。
同時に、FreecivCalc2のインターフェース部分もテンプレートを用いて外部ファイルからコンテンツ内容を流し込んでいるため、容易に多言語化が可能になっています。</p>

<p>現状では、classicルールセットを日本語および英語の2か国語で対応しています。</p>

<h2 id="開発について:0fe09111c483b88d0d4fda3fcdc49d63">開発について</h2>

<p>FreecivCalc2は三条項BSDライセンス下で公開されています。</p>

<p>ローカル環境でのビルド、他のルールセットや言語に対応させるためのデータセットの文法などについては<a href="https://github.com/Tatamo/freecivcalc2">GitHubリポジトリ</a>上で記述しているため、そちらを参照してください。</p>

<p>FreecivCalc2は大半をTypeScriptで、jQuery UIのウィジェット定義など一部を生のJavaScriptで書いています。</p>

<p>また使用したライブラリはjQuery, jQuery UI, amChartsです。
当初jQueryを使う予定はなかったのですが、ユニット選択用のUIとしてコンボボックスを実現するためのライブラリを探していたところjQuery UIが最も用途に適っていたため採用し、その流れでjQueryも使用することになりました。
amChartsは簡単にグラフを表示できるライブラリとして使いやすそうだったため使用しました。</p>

<p>その他、外部JSONファイルからテンプレートを通してHTMLファイルを生成するためのテンプレートエンジンとしてEJSを使用しました。</p>

        <p><a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="__tatamo__">Tweet</a></p>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </article>
    <nav class="article-nav-adjacent">
        <span class="article-link-next"><a href="http://tatamo.81.la/blog/2016/09/29/freeciv-arago-challenge-01/">&lt;- Newer: aragoのHIROic ChallengeでのFreecivプレイレポ 前編</a></span>
        <span class="article-link-border"></span>
        <span class="article-link-prev"><a href="http://tatamo.81.la/blog/2016/02/20/freeciv-build-first-cities/">Older: Freecivオンラインプレイ解説 最初の都市を建設するまで -&gt;</a></span>
    </nav>

    </div>
    <aside class="sidebar">
        <div class="sidebar-content">
            <section>
                <h2 class="panel-title">Recent Posts</h2>
                <ul>
                <li><a href="http://tatamo.81.la/blog/2017/07/11/freeciv-arago-challenge-02/" class="list-group-item">HIROic Freeciv Challengeの参加結果</a></li>
                <li><a href="http://tatamo.81.la/blog/2017/05/29/seccamp-2017-sheet/" class="list-group-item">セキュリティキャンプ2017の応募用紙</a></li>
                <li><a href="http://tatamo.81.la/blog/2017/04/04/lr-parser-generator-implementation-06/" class="list-group-item">LR(1)パーサジェネレータを自作して構文解析をする 第6回:パーサの実装と構文解析の実行</a></li>
                <li><a href="http://tatamo.81.la/blog/2017/04/04/lr-parser-generator-implementation-05/" class="list-group-item">LR(1)パーサジェネレータを自作して構文解析をする 第5回:LR(1)パーサジェネレータの実装</a></li>
                <li><a href="http://tatamo.81.la/blog/2017/03/22/lr-parser-generator-implementation-04/" class="list-group-item">LR(1)パーサジェネレータを自作して構文解析をする 第4回:かんたんLR(1)法入門</a></li>
                <li><a href="http://tatamo.81.la/blog/2017/03/21/lr-parser-generator-implementation-03/" class="list-group-item">LR(1)パーサジェネレータを自作して構文解析をする 第3回:儀式の下準備</a></li>
                </ul>
            </section>
            
            <section>
                <h2 class="panel-title"><a href="http://tatamo.81.la/blog/categories/">Categories</a></h2>
                <ul>
                <li><a href="http://tatamo.81.la/blog/categories/dev">dev (12)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/game">game (4)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/info">info (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/categories/pc">pc (1)</a></li>
                </ul>
            </section>
            <section>
                <h2 class="panel-title"><a href="http://tatamo.81.la/blog/tags/">Tags</a></h2>
                <ul>
                <li><a href="http://tatamo.81.la/blog/tags/arago">arago (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/blog">blog (4)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/deploybot">deploybot (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/freeciv">freeciv (5)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/freecivcalc">freecivcalc (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/generics">generics (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/github">github (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/highlight_js">highlight_js (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/homebuilt_pc">homebuilt_pc (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/hugo">hugo (2)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/info">info (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/java">java (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/javascript">javascript (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/lexer">lexer (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/parser">parser (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/parser-generator">parser-generator (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/parsing">parsing (6)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/reflection">reflection (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/seccamp">seccamp (1)</a></li>
                <li><a href="http://tatamo.81.la/blog/tags/wercker">wercker (1)</a></li>
                </ul>
            </section>
        </div>
    </aside>

    </div>
   <footer>
        <p>Copyright (c) 2015 <a href="about/">Tatamo</a>.</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a></p>
    </footer>
</body>
</html>

